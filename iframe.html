<html>
  <head>
    <meta charset="utf-8">
    <title>in iframe</title>
    <meta name="robots" content="noindex, nofollow">
  </head>
  <body>
    <h1 id="label">Hello from iFrame</h1>
    <button id="btn">Set Cookie</h1>
    
    <script type="text/javascript">
      
        function setCookie(cname,cvalue, daysExpire){
            var d = new Date();
            d.setTime(d.getTime()+(daysExpire * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toGMTString();
             
            document.cookie = cname + "=" + cvalue + "; " + expires + " ; path=/ ;"
        }
      
        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
          
            return null;
        }
      
        function handleMessage(e) {
            if (e.origin !== "http://localhost:3000") return;  
        
            switch(e.data.action) {
                case "get":
                    var c = getCookie(e.data.name);
                    e.source.postMessage({name: e.data.name, value: c}, "http://localhost:3000");
                    break;
                case "set":
                    setCookie(e.data.name,e.data.value,5);
                    document.getElementById("label").innerHTML = "Cookie set! " + e.data.name;
                    break;
                default:
                    document.getElementById("label").innerHTML = "Unknown action!";
            }   
        }
     
        function handleClick(e) {
          e.preventDefault();
          
          setCookie("mytest","myvalue",5);
        }
        
        document.getElementById("btn").addEventListener("click", handleClick, false);
        window.addEventListener("message", handleMessage, false);
    </script>
  </body>
</html>
